<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
    <link rel="stylesheet" type="text/css" href="style">
    <!-- Bootstrap CSS-framework -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </head>
  <body>

<div class="container">
  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
      <!-- Modal content-->
      <div class="modal-content">
        <!-- chat name form -->
        <form action="" id="connectnameform">

          <div class="modal-header">
            <!-- <button type="button" class="close" data-dismiss="modal">&times;</button> -->
            <h4 class="modal-title">Welcome to the chat</h4>
          </div>

          <div class="modal-body">
            <label for="chatname">Enter chat name: </label>
              <input type="text" name="chatname" id="chatname" required>
          </div>

          <div class="modal-footer">
            <button id="setchatname" type="submit" class="btn btn-default">Join chat</button>
          </div>

        </form>
      </div>
    </div>
  </div>
</div>
    
    <!-- chat message form -->
    <ul id="messages"></ul>
    <form action="" id="sendmessageform">
      <input id="messagebutton" autocomplete="off" /><button>Send</button>
    </form>
  
  <!-- external scripts -->
  <!-- load socket.io client and scripts..."exposes a io global, and then connect" -->
  <script src="/socket.io/socket.io.js"></script>
  <!-- <script src="https://code.jquery.com/jquery-1.11.1.js"></script> -->
<script>
    
//onload functionality
$('#myModal').modal({backdrop: 'static', keyboard: false});
$('#myModal').modal('show');
$('#messagebutton').prop('disabled', true);
$('#chatname').focus();

$(function () {

  //no URL in io() specified, since it defaults to trying to connect to the host that serves the page
  var socket = io();

  //user connects to chat
  $('#connectnameform').submit(function(){
    $('#myModal').modal('hide');
    socket.emit('user register', $('#chatname').val(), function(data){
        $('#messages').append($('<li class="red">').text(data));
    });

    $(':input[type="submit"]').prop('disabled', true);
    $(':input[type="text"]').prop('disabled', true);
    $('#messagebutton').prop('disabled', false);
    $("#messagebutton").focus();
    
    return false;
  });

  //submit textmessage
  $('#sendmessageform').submit(function(){

      socket.emit('userinput', $('#messagebutton').val(), function(data){
        $('#messages').append($('<li class="red">').text(data));
      });

    $('#messagebutton').val('');
    return false;
  });

  //append textmessage to chat
  socket.on('chat message', function(msg){
    $('#messages').append($('<li>').text(msg));
  });

  //whisper
  socket.on('whisper', function(msg){
    $('#messages').append($('<li class="green">').text(msg));
  });

  //getting users list
  socket.on('get users', function(userlist){
    var allusers;
    allusers = '<li>----- Online users -----</li>';

    for(i = 0; i < userlist.length;i++){
      allusers += '<li>' + userlist[i] + '</li>';
    }
    allusers += '<li>-----------------------------</li>';

    //appends all at once
    $('#messages').append(allusers);
  });

});
</script>
</html>